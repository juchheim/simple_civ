# Doc Drift Report 01 (Code vs Docs, current state)

- Rulebook 3.7.3 Start guarantees are only partially handled: starts now check for ≥6 distance and nearby food/prod/settle tiles, but there is no regeneration/rezoning loop or best-available fallback scoring if guarantees fail (`engine/src/map/map-generator.ts`, `client/src/utils/map-generator.ts`).
- Dev-spec map shape: code now exposes `features` (alias of overlays), `ownerCityId`/`hasCityCenter`, and a `map.rivers` edge list derived from river paths, but rivers are still generated as tile overlays first and there is no edge-driven river gen; overlays remain the source of truth (`engine/src/core/types.ts`, `engine/src/map/map-generator.ts`, client mirror).
- Dev-spec mapgen pipeline is still simplified but closer: coasts are biased to map edges, mountain clusters are placed, rivers include an edge list, and start sites pick best-fit spots with ≥6 spacing and yield checks. Remaining gaps: no `mapGenParams` tunables (density toggles, coast bias knobs), no multi-pass reroll/regeneration beyond best-fit selection, and rivers still originate as tile overlays rather than edge-driven (`engine/src/map/map-generator.ts`, client mirror).
- Dev-spec helper modules `cities.ts.md` / `states.ts.md` are absent; capture, raze, growth, fortify/heal live directly in turn-loop files instead of the documented utilities (`engine/src/game/turn-loop.ts`, `client/src/utils/turn-loop.ts`).
- Dev-spec AI modules (`aiHeuristics.ts.md`, `aiDecisions.ts.md`) remain unimplemented; the shipped AI is a minimal fallback (tech/build choice + auto end turn) rather than the scripted heuristics/personality described in docs.
- New engine feature not documented in rulebook/dev-spec: a mutual vision-sharing pact (offer/accept/revoke, peace-gated) that merges visibility between civs (`engine/src/core/types.ts`, `engine/src/game/turn-loop.ts:457-560,819-876,985-1013`; UI in `client/src/components/HUD.tsx`).
- docs/IMPLEMENTATION_STATUS.md is largely stale: it claims map/city/combat/unit systems are fully implemented and that capture, diplomacy, and victory are missing, but code now includes city capture/raze, war/peace handling (plus vision sharing), fog-of-war, and Progress/Conquest victories (`engine/src/game/turn-loop.ts`, `client/src/utils/turn-loop.ts`, `docs/IMPLEMENTATION_STATUS.md`).
